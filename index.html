
Da uma melhorada nesse codigo e para rodar em um iphone 12pro

pasted_content.txt
Texto ¬∑ 34.20 KB
Lite
Recebi seu pedido e vou melhorar o c√≥digo para que ele funcione em um iPhone 12 Pro.
Estou analisando o c√≥digo fornecido para identificar melhorias e otimiza√ß√µes espec√≠ficas para o iPhone 12 Pro.

Analisando o c√≥digo, identifiquei que o foco √© um painel financeiro com rel√≥gios, conversores e alertas. Planejo otimizar a responsividade e desempenho no iPhone 12 Pro na pr√≥xima fase.

Analisando o c√≥digo, identifiquei foco no painel financeiro e ajustes de fuso hor√°rio. Planejo melhorar a responsividade e desempenho, especialmente para o iPhone 12 Pro na pr√≥xima fase.

Ajustei o carregamento de recursos, corrigi tags duplicadas e otimizei a responsividade para o iPhone 12 Pro. Vou revisar o conte√∫do atualizado para garantir a precis√£o.

Corrigi as tags duplicadas de script e ajustei a responsividade para o iPhone 12 Pro, usando uma abordagem mais geral em max-width de 414px para melhor compatibilidade.

Identifiquei que ajustei as tags duplicadas e otimizei a responsividade para o iPhone 12 Pro usando uma abordagem geral de max-width, melhorando compatibilidade e manuten√ß√£o do layout.

Corrigi erros na manipula√ß√£o de rel√≥gios e sess√µes, usando fragmentos de documento para desempenho e ajustei o loop de alertas para limpar a cada dia. O foco √© responsividade e efici√™ncia.

Corrigi as tags de script malformadas no HTML, garantindo carregamento correto. Foco agora √© analisar o c√≥digo para otimizar desempenho e responsividade no iPhone 12 Pro.

Analisei o c√≥digo, confirmei ajustes no HTML e implementei melhorias para otimizar carregamento, responsividade e desempenho especialmente para iPhone 12 Pro. Pr√≥ximo passo: ajustar scripts e recursos.

Lite
O c√≥digo foi otimizado para melhor desempenho e responsividade em dispositivos m√≥veis, especialmente o iPhone 12 Pro. As principais melhorias incluem:
Otimiza√ß√£o de Carregamento: Adi√ß√£o de async e defer aos scripts e preload para fontes para um carregamento mais r√°pido.
Meta Viewport: Ajuste na tag viewport com viewport-fit=cover para melhor aproveitamento da tela em iPhones com notch.
Responsividade CSS: Ajustes nas media queries para telas de at√© 414px (cobrir iPhone 12 Pro e similares), otimizando tamanhos de fonte, paddings e layouts de grid.
Manipula√ß√£o do DOM: Uso de DocumentFragments no JavaScript para inser√ß√µes de elementos DOM mais eficientes, reduzindo o reflow e repaint do navegador.
Alertas de Sess√£o: A l√≥gica de triggeredAlerts foi aprimorada para garantir que os alertas sejam disparados apenas uma vez por dia para cada mercado, limpando o hist√≥rico de alertas ao iniciar um novo dia.
Tratamento de Erros: Adi√ß√£o de console.error em getUtcOffset e showToast em fetchCurrencyRates para um tratamento de erros mais robusto.
O arquivo kairos_dashboard_optimized.html cont√©m o c√≥digo melhorado.
kairos_dashboard_optimized.html
C√≥digo ¬∑ 35.00 KB

Ver todos os arquivos nesta tarefa
corrija quero q coloca as bandeiras dos paises e quero ir vende como estar ficando o projeto mostar as sessoes dos mercados q n estar mostrando 
Identifiquei que as bandeiras est√£o bem definidas, mas as sess√µes de mercado ainda n√£o exibem corretamente. Pr√≥ximo passo: ajustar a exibi√ß√£o das sess√µes conforme o hor√°rio e fusos.

Ajustei a exibi√ß√£o das sess√µes de mercado para usar o hor√°rio correto, considerando se j√° passou do fechamento, e corrigi o HTML para mostrar as bandeiras corretamente. Pr√≥ximo passo: testar a visualiza√ß√£o em tempo real.

Verifiquei conflitos na porta 8000, matei o processo e reiniciei o servidor web para testar a visualiza√ß√£o em tempo real do HTML corrigido.

Lite
O projeto est√° dispon√≠vel para visualiza√ß√£o neste link: https://8000-iaahqi1y0x2iu0apuc18y-62c9bf57.manusvm.computer
Verifiquei que o servidor foi iniciado na porta 8000 e est√° acess√≠vel. Pr√≥ximo passo: revisar o c√≥digo para exibir bandeiras e sess√µes de mercado corretamente.

Identifiquei que o servidor na porta 8000 est√° acess√≠vel; o pr√≥ximo passo √© revisar o c√≥digo para corrigir a exibi√ß√£o das bandeiras e sess√µes de mercado.

Lite
O c√≥digo foi corrigido para exibir as bandeiras dos pa√≠ses e as sess√µes de mercado corretamente. Al√©m disso, o projeto est√° agora dispon√≠vel para visualiza√ß√£o em tempo real atrav√©s do seguinte link:
KAIROS Dashboard Otimizado
Por favor, acesse o link para verificar as altera√ß√µes e me informe se h√° mais alguma coisa que voc√™ gostaria de ajustar.
kairos_dashboard_optimized.html
C√≥digo ¬∑ 35.20 KB

Ver todos os arquivos nesta tarefa
Implante este site permanentemente.
Lite
Para implantar o site permanentemente, preciso de algumas informa√ß√µes adicionais. Voc√™ tem um servi√ßo de hospedagem ou provedor de nuvem preferido (como Netlify, Vercel, AWS S3, GitHub Pages, etc.)? Ou gostaria que eu sugerisse um?
Manus continuar√° trabalhando ap√≥s sua resposta

Enviar mensagem para Manus
kairos_dashboard_optimized.html
'''
<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>KAIROS Dashboard</title>
    <!-- Pr√©-conex√£o para dom√≠nios de terceiros para melhorar o desempenho de carregamento -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Otimiza√ß√£o para carregamento de fontes -->
    <link rel="preload" href="https://fonts.gstatic.com/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxK.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/roboto/v20/KFOlCnqEu92Fr1MmEU9fBBc4.woff2" as="font" type="font/woff2" crossorigin>
    <!-- Carregamento ass√≠ncrono para scripts n√£o cr√≠ticos -->
    <script src="https://cdn.tailwindcss.com" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .no-spinner::-webkit-outer-spin-button,
        .no-spinner::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .no-spinner {
            -moz-appearance: textfield;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 180px;
            max-height: 220px;
        }
        /* Ajustes espec√≠ficos para iPhone 12 Pro e outros dispositivos m√≥veis */
        @media (max-width: 414px) { /* iPhone 12 Pro √© 390px, outros iPhones similares */
            body {
                font-size: 14px;
            }
            .chart-container {
                height: 150px;
            }
            .text-xl {
                font-size: 1.125rem;
            }
            .text-lg {
                font-size: 1rem;
            }
            .p-4 {
                padding: 0.75rem;
            }
            .sm\:grid-cols-3 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div id="app" class="max-w-md mx-auto bg-gray-900 min-h-screen">
        <header class="sticky top-0 bg-gray-900 bg-opacity-80 backdrop-blur-md z-10 p-4 pt-6 flex justify-between items-center">
            <h1 class="text-xl font-bold text-white">KAIROS</h1>
        </header>

        <main class="p-4 space-y-6">
            <section id="clocks">
                <h2 class="text-lg font-semibold mb-3 text-blue-300">Rel√≥gios Globais</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    <!-- Rel√≥gios s√£o injetados aqui pelo JS -->
                </div>
            </section>

            <section id="sessions">
                <h2 class="text-lg font-semibold mb-3 text-blue-300">Sess√µes de Mercado</h2>
                <p class="text-sm text-gray-400 mb-4">
                    Acompanhe o estado de abertura dos principais mercados globais, com hor√°rios e contadores ajustados para o fuso de Bras√≠lia (BRT).
                </p>
                <div class="space-y-4">
                    <!-- Sess√µes s√£o injetadas aqui pelo JS -->
                </div>
                <div class="mt-4 bg-gray-800 p-4 rounded-xl">
                    <h3 class="text-md font-medium text-center text-gray-300 mb-2">Sobreposi√ß√£o de Sess√µes (BRT)</h3>
                    <div class="chart-container">
                        <canvas id="sessionsChart"></canvas>
                    </div>
                </div>
            </section>

            <div class="space-y-6">
                <section id="time-converter">
                    <h2 class="text-lg font-semibold mb-3 text-blue-300">Conversor de Hor√°rio</h2>
                    <p class="text-sm text-gray-400 mb-4">Insira um hor√°rio em qualquer mercado para ver a correspond√™ncia nos outros centros financeiros instantaneamente.</p>
                    <div class="bg-gray-800 p-4 rounded-xl space-y-4">
                        <div class="flex items-center space-x-2">
                            <input type="time" id="time-input" class="bg-gray-700 text-white rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <select id="timezone-select" class="bg-gray-700 text-white rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                        </div>
                        <div id="converted-times" class="text-center text-gray-300 space-y-1"></div>
                    </div>
                </section>

                <section id="currency-converter">
                    <h2 class="text-lg font-semibold mb-3 text-blue-300">Conversor Cambial</h2>
                    <p class="text-sm text-gray-400 mb-4">Cota√ß√µes em tempo real. Digite um valor em qualquer moeda para converter para as demais. As taxas s√£o atualizadas a cada minuto.</p>
                    <div id="currency-list" class="bg-gray-800 p-4 rounded-xl space-y-3"></div>
                </section>

                <section id="alerts">
                    <h2 class="text-lg font-semibold mb-3 text-blue-300">Alertas Inteligentes</h2>
                    <p class="text-sm text-gray-400 mb-4">Configure notifica√ß√µes para aberturas de sess√£o e eventos econ√≥micos de alta volatilidade.</p>
                    <div class="bg-gray-800 p-4 rounded-xl space-y-4">
                        <div>
                            <h3 class="font-medium text-white mb-2">Alertas de Sess√£o</h3>
                            <div id="session-alerts" class="space-y-2"></div>
                        </div>
                        <div>
                            <h3 class="font-medium text-white mb-2">Pr√≥ximos Eventos de Volatilidade</h3>
                            <div id="economic-events" class="space-y-2 text-sm"></div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <div id="toast" class="fixed bottom-10 right-10 flex items-center bg-blue-500 text-white py-3 px-5 rounded-lg shadow-lg transform translate-x-[150%] transition-transform duration-500 ease-in-out">
        <span id="toast-icon" class="mr-3 text-xl">üîî</span>
        <span id="toast-message"></span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const markets = [
                { id: 'ny', name: 'Nova Iorque', flag: 'üá∫üá∏', timeZone: 'America/New_York', open: '09:30', close: '16:00' },
                { id: 'frankfurt', name: 'Frankfurt', flag: 'üá™üá∫', timeZone: 'Europe/Berlin', open: '09:00', close: '17:30' },
                { id: 'london', name: 'Londres', flag: 'üá¨üáß', timeZone: 'Europe/London', open: '08:00', close: '16:30' },
                { id: 'tokyo', name: 'T√≥quio', flag: 'üáØüáµ', timeZone: 'Asia/Tokyo', open: '09:00', close: '15:00' },
                { id: 'brasilia', name: 'Bras√≠lia', flag: 'üáßüá∑', timeZone: 'America/Sao_Paulo', open: '10:00', close: '18:00' }
            ];

            const currencies = [
                { code: 'BRL', name: 'Real', flag: 'üáßüá∑' },
                { code: 'USD', name: 'D√≥lar', flag: 'üá∫üá∏' },
                { code: 'EUR', name: 'Euro', flag: 'üá™üá∫' },
                { code: 'GBP', name: 'Libra', flag: 'üá¨üáß' },
                { code: 'CHF', name: 'Franco', flag: 'üá®üá≠' }
            ];

            const economicEventsMock = [
                { time: '10:30', event: 'CPI (EUA)', impact: 3 },
                { time: '15:00', event: 'Discurso da Fed', impact: 3 },
                { time: 'Amanh√£ 09:30', event: 'Payroll (EUA)', impact: 3 },
            ];

            let currencyRates = {};
            let alertSettings = { tokyo: true, london: true, ny: true, frankfurt: true };
            const triggeredAlerts = new Set();
            let audioContext;

            function getUtcOffset(timeZone) {
                try {
                    const now = new Date();
                    const formatter = new Intl.DateTimeFormat('en-US', { timeZone, timeZoneName: 'shortOffset' });
                    const parts = formatter.formatToParts(now);
                    const offsetPart = parts.find(p => p.type === 'timeZoneName');
                    return offsetPart ? offsetPart.value.replace('GMT', 'UTC') : 'UTC';
                } catch (e) {
                    console.error('Erro ao obter offset UTC:', e);
                    return 'UTC';
                }
            }

            function formatTime(date) {
                return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', hour12: false });
            }

            function renderClocks() {
                const clocksContainer = document.querySelector('#clocks .grid');
                if (!clocksContainer) return;
                const fragment = document.createDocumentFragment();
                
                markets.forEach(market => {
                    const now = new Date();
                    const marketTime = new Date(now.toLocaleString('en-US', { timeZone: market.timeZone }));
                    const formattedTime = formatTime(marketTime);
                    const utcOffset = getUtcOffset(market.timeZone);

                    const clockDiv = document.createElement('div');
                    clockDiv.className = 'bg-gray-800 p-3 rounded-xl shadow flex flex-col items-center';
                    clockDiv.innerHTML = `
                        <span class="text-xl">${market.flag}</span>
                        <span class="text-xs text-gray-400 mt-1">${market.name}</span>
                        <span class="font-bold text-lg text-white">${formattedTime}</span>
                        <span class="text-xs text-gray-500">${utcOffset}</span>
                    `;
                    fragment.appendChild(clockDiv);
                });
                clocksContainer.innerHTML = '';
                clocksContainer.appendChild(fragment);
            }

            function getCountdown(targetDate) {
                const now = new Date();
                const diff = targetDate.getTime() - now.getTime();

                if (diff < 0) return '00:00:00';

                const totalSeconds = Math.floor(diff / 1000);
                const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
                const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
                const seconds = String(totalSeconds % 60).padStart(2, '0');

                return `${hours}:${minutes}:${seconds}`;
            }

            function renderSessions() {
                const sessionsContainer = document.getElementById('sessions')?.querySelector('.space-y-4');
                if (!sessionsContainer) return;
                const fragment = document.createDocumentFragment();
                const brtTimeZone = 'America/Sao_Paulo';
                const now = new Date();
                const nowBRT = new Date(now.toLocaleString('en-US', { timeZone: brtTimeZone }));

                markets.forEach(market => {
                    const [openH, openM] = market.open.split(':').map(Number);
                    const [closeH, closeM] = market.close.split(':').map(Number);

                    const marketOpenTime = new Date(now.toLocaleString('en-US', { timeZone: market.timeZone }));
                    marketOpenTime.setHours(openH, openM, 0, 0);
                    const marketCloseTime = new Date(now.toLocaleString('en-US', { timeZone: market.timeZone }));
                    marketCloseTime.setHours(closeH, closeM, 0, 0);

                    const marketOpenTimeBRT = new Date(marketOpenTime.toLocaleString('en-US', { timeZone: brtTimeZone }));
                    const marketCloseTimeBRT = new Date(marketCloseTime.toLocaleString('en-US', { timeZone: brtTimeZone }));

                    let status = '';
                    let countdown = '00:00:00';
                    let statusColor = 'text-gray-400';

                    if (nowBRT >= marketOpenTimeBRT && nowBRT < marketCloseTimeBRT) {
                        status = 'Aberto';
                        statusColor = 'text-green-400';
                        countdown = getCountdown(marketCloseTimeBRT);
                    } else if (nowBRT < marketOpenTimeBRT) {
                        status = 'Abre em';
                        statusColor = 'text-yellow-400';
                        countdown = getCountdown(marketOpenTimeBRT);
                    } else {
                        status = 'Fechado';
                        statusColor = 'text-red-400';
                        const nextOpen = new Date(marketOpenTimeBRT);
                        // Se j√° passou do hor√°rio de fechamento, calcula para o dia seguinte
                        if (nowBRT > marketCloseTimeBRT) {
                            nextOpen.setDate(nextOpen.getDate() + 1);
                        }
                        countdown = getCountdown(nextOpen);
                    }

                    const sessionDiv = document.createElement('div');
                    sessionDiv.className = 'flex items-center justify-between bg-gray-800 p-3 rounded-xl shadow';
                    sessionDiv.innerHTML = `
                            <div class="flex items-center">
                                <span class="text-xl mr-3">${market.flag}</span>
                                <div>
                                    <p class="font-medium text-white">${market.name}</p>
                                    <p class="text-xs text-gray-400">${formatTime(marketOpenTimeBRT)} - ${formatTime(marketCloseTimeBRT)} BRT</p>
                                </div>
                            </div>
                        <div class="text-right">
                            <p class="font-bold ${statusColor}">${status}</p>
                            <p class="text-sm text-gray-300">${countdown}</p>
                        </div>
                    `;
                    fragment.appendChild(sessionDiv);
                });
                sessionsContainer.innerHTML = '';
                sessionsContainer.appendChild(fragment);
            }

            let sessionsChartInstance = null;

            function renderSessionsChart() {
                const ctx = document.getElementById('sessionsChart')?.getContext('2d');
                if (!ctx) return;

                const brtTimeZone = 'America/Sao_Paulo';
                const now = new Date();
                const nowBRT = new Date(now.toLocaleString('en-US', { timeZone: brtTimeZone }));
                const currentHourBRT = nowBRT.getHours() + nowBRT.getMinutes() / 60;

                const labels = Array.from({ length: 24 }, (_, i) => `${String(i).padStart(2, '0')}:00`);
                const datasets = markets.filter(m => m.id !== 'brasilia').map(market => {
                    const [openH, openM] = market.open.split(':').map(Number);
                    const [closeH, closeM] = market.close.split(':').map(Number);

                    const marketOpenTime = new Date(now.toLocaleString('en-US', { timeZone: market.timeZone }));
                    marketOpenTime.setHours(openH, openM, 0, 0);
                    const marketCloseTime = new Date(now.toLocaleString('en-US', { timeZone: market.timeZone }));
                    marketCloseTime.setHours(closeH, closeM, 0, 0);

                    const marketOpenTimeBRT = new Date(marketOpenTime.toLocaleString('en-US', { timeZone: brtTimeZone }));
                    const marketCloseTimeBRT = new Date(marketCloseTime.toLocaleString('en-US', { timeZone: brtTimeZone }));

                    let startHour = marketOpenTimeBRT.getHours() + marketOpenTimeBRT.getMinutes() / 60;
                    let endHour = marketCloseTimeBRT.getHours() + marketCloseTimeBRT.getMinutes() / 60;

                    if (endHour < startHour) {
                        endHour += 24;
                    }

                    const data = labels.map((_, i) => {
                        const hour = i;
                        if (hour >= startHour && hour < endHour) {
                            return 1;
                        }
                        return 0;
                    });

                    return {
                        label: market.name,
                        data: data,
                        backgroundColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.6)`,
                        borderColor: 'rgba(255, 255, 255, 0.8)',
                        borderWidth: 1,
                        barPercentage: 0.8,
                        categoryPercentage: 0.8,
                    };
                });

                const currentTimeLinePlugin = {
                    id: 'currentTimeLine',
                    afterDatasetsDraw(chart, args, options) {
                        const { ctx, chartArea: { left, right, top, bottom }, scales: { x } } = chart;
                        ctx.save();
                        const currentX = x.getPixelForValue(Math.floor(currentHourBRT));
                        const xOffset = (currentHourBRT % 1) * (x.getPixelForValue(1) - x.getPixelForValue(0));

                        ctx.beginPath();
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                        ctx.lineWidth = 2;
                        ctx.moveTo(currentX + xOffset, top);
                        ctx.lineTo(currentX + xOffset, bottom);
                        ctx.stroke();

                        ctx.restore();
                    }
                };

                if (sessionsChartInstance) {
                    sessionsChartInstance.data.labels = labels;
                    sessionsChartInstance.data.datasets = datasets;
                    sessionsChartInstance.update();
                } else {
                    sessionsChartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: datasets
                        },
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    stacked: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: 'rgba(255, 255, 255, 0.7)',
                                        maxRotation: 0,
                                        minRotation: 0,
                                    },
                                    title: {
                                        display: true,
                                        text: 'Hora (BRT)',
                                        color: 'rgba(255, 255, 255, 0.8)'
                                    }
                                },
                                y: {
                                    stacked: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: 'rgba(255, 255, 255, 0.7)',
                                        autoSkip: false,
                                        maxRotation: 0,
                                        minRotation: 0,
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'bottom',
                                    labels: {
                                        color: 'rgba(255, 255, 255, 0.9)'
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.raw === 1) {
                                                label += 'Aberto';
                                            } else {
                                                label += 'Fechado';
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        },
                        plugins: [currentTimeLinePlugin]
                    });
                }
            }

            function populateTimezoneSelect() {
                const timezoneSelect = document.getElementById('timezone-select');
                if (!timezoneSelect) return;
                const fragment = document.createDocumentFragment();
                markets.forEach(market => {
                    const option = document.createElement('option');
                    option.value = market.timeZone;
                    option.textContent = `${market.name} (${getUtcOffset(market.timeZone)})`;
                    fragment.appendChild(option);
                });

                const userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                if (!markets.some(market => market.timeZone === userTimeZone)) {
                    const option = document.createElement('option');
                    option.value = userTimeZone;
                    option.textContent = `Local (${getUtcOffset(userTimeZone)})`;
                    fragment.appendChild(option);
                }
                timezoneSelect.appendChild(fragment);
                timezoneSelect.value = 'America/Sao_Paulo';
            }

            function convertTime() {
                const timeInput = document.getElementById('time-input');
                const timezoneSelect = document.getElementById('timezone-select');
                const convertedTimesDiv = document.getElementById('converted-times');
                if (!timeInput || !timezoneSelect || !convertedTimesDiv) return;

                const inputTime = timeInput.value;
                const fromTimeZone = timezoneSelect.value;
                if (!inputTime) return;

                const [hours, minutes] = inputTime.split(':').map(Number);
                const sourceDate = new Date();
                const tempDate = new Date(sourceDate.toLocaleString('en-US', { timeZone: fromTimeZone }));
                tempDate.setHours(hours, minutes, 0, 0);

                convertedTimesDiv.innerHTML = '';
                const fragment = document.createDocumentFragment();
                markets.forEach(market => {
                    if (market.timeZone !== fromTimeZone) {
                        const convertedTime = new Date(tempDate.toLocaleString('en-US', { timeZone: market.timeZone }));
                        const p = document.createElement('p');
                        p.innerHTML = `<span class="font-semibold">${market.name}:</span> ${formatTime(convertedTime)}`;
                        fragment.appendChild(p);
                    }
                });
                convertedTimesDiv.appendChild(fragment);
            }

            async function fetchCurrencyRates() {
                try {
                    const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                    const data = await response.json();
                    if (data && data.rates) {
                        currencyRates = data.rates;
                        renderCurrencyConverter();
                    }
                } catch (error) {
                    console.error('Erro ao buscar taxas de c√¢mbio:', error);
                    showToast('Erro ao atualizar cota√ß√µes', '‚ùå');
                }
            }

            function renderCurrencyConverter() {
                const currencyListDiv = document.getElementById('currency-list');
                if (!currencyListDiv) return;
                const fragment = document.createDocumentFragment();
                const baseCurrency = 'BRL';

                currencies.forEach(currency => {
                    const rate = currencyRates[currency.code] || 1;
                    const value = (currency.code === baseCurrency) ? '1.00' : (1 / currencyRates[baseCurrency] * rate).toFixed(2);

                    const currencyDiv = document.createElement('div');
                    currencyDiv.className = 'flex items-center justify-between bg-gray-700 p-3 rounded-lg';
                    currencyDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="text-xl mr-3">${currency.flag}</span>
                            <span class="text-white font-medium">${currency.code} - ${currency.name}</span>
                        </div>
                        <input type="number" step="0.01" data-currency="${currency.code}" value="${value}" class="bg-gray-600 text-white rounded-lg p-2 w-32 text-right no-spinner focus:outline-none focus:ring-2 focus:ring-blue-500">
                    `;
                    fragment.appendChild(currencyDiv);
                });
                currencyListDiv.innerHTML = '';
                currencyListDiv.appendChild(fragment);

                currencyListDiv.querySelectorAll('input').forEach(input => input.addEventListener('input', handleCurrencyInput));
                
                const brlInput = currencyListDiv.querySelector('input[data-currency="BRL"]');
                if (brlInput && brlInput.value === '0.00') {
                    brlInput.value = '1.00';
                    handleCurrencyInput({ target: brlInput });
                }
            }

            function handleCurrencyInput({ target }) {
                const value = parseFloat(target.value);
                const changedCurrency = target.dataset.currency;

                if (isNaN(value) || !currencyRates[changedCurrency]) return;

                const valueInUSD = value / currencyRates[changedCurrency];
                document.querySelectorAll('#currency-list input').forEach(input => {
                    if (input !== target) {
                        input.value = (valueInUSD * currencyRates[input.dataset.currency]).toFixed(2);
                    }
                });
            }

            function renderAlertSettings() {
                const sessionAlertsDiv = document.getElementById('session-alerts');
                if(!sessionAlertsDiv) return;
                const fragment = document.createDocumentFragment();

                markets.filter(m => m.id !== 'brasilia').forEach(market => { 
                    const isEnabled = alertSettings[market.id];
                    const label = document.createElement('label');
                    label.className = 'flex items-center justify-between p-2 bg-gray-700 rounded-lg cursor-pointer';
                    label.innerHTML = `
                        <span class="text-white">${market.flag} ${market.name} - Abertura</span>
                        <input type="checkbox" data-market-id="${market.id}" ${isEnabled ? 'checked' : ''} class="toggle-checkbox form-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-500">
                    `;
                    fragment.appendChild(label);
                });
                sessionAlertsDiv.innerHTML = '';
                sessionAlertsDiv.appendChild(fragment);

                sessionAlertsDiv.querySelectorAll('.toggle-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (event) => {
                        const marketId = event.target.dataset.marketId;
                        alertSettings[marketId] = event.target.checked;
                        saveAlertSettings();
                        showToast(`Alerta para ${markets.find(m => m.id === marketId).name} ${event.target.checked ? 'ativado' : 'desativado'}`, 'üîî');
                    });
                });
            }

            function renderEconomicEvents() {
                const economicEventsDiv = document.getElementById('economic-events');
                if(!economicEventsDiv) return;
                const fragment = document.createDocumentFragment();

                if (economicEventsMock.length === 0) {
                    const p = document.createElement('p');
                    p.className = 'text-gray-500';
                    p.textContent = 'Nenhum evento de alta volatilidade pr√≥ximo.';
                    fragment.appendChild(p);
                } else {
                    economicEventsMock.forEach(event => {
                        const eventDiv = document.createElement('div');
                        eventDiv.className = 'flex justify-between items-center p-2 bg-gray-700 rounded-lg';
                        eventDiv.innerHTML = `
                            <span class="text-gray-300">${event.time} - ${event.event}</span>
                            <span class="text-yellow-400">${'‚≠ê'.repeat(event.impact)}</span>
                        `;
                        fragment.appendChild(eventDiv);
                    });
                }
                economicEventsDiv.innerHTML = '';
                economicEventsDiv.appendChild(fragment);
            }
            
            function checkSessionAlerts() {
                const nowBRT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Sao_Paulo' }));

                markets.forEach(market => {
                    if (!alertSettings[market.id]) return;

                    const [openH, openM] = market.open.split(':').map(Number);
                    const marketDate = new Date(new Date().toLocaleString('en-US', { timeZone: market.timeZone }));
                    marketDate.setHours(openH, openM, 0, 0);
                    const marketOpenTime = new Date(marketDate);
                    const marketOpenTimeBRT = new Date(marketOpenTime.toLocaleString('en-US', { timeZone: 'America/Sao_Paulo' }));
                    
                    const fiveMinutesBeforeOpen = new Date(marketOpenTimeBRT.getTime() - 5 * 60000);

                    const triggerKey = `${market.id}-${fiveMinutesBeforeOpen.getHours()}:${fiveMinutesBeforeOpen.getMinutes()}-${fiveMinutesBeforeOpen.getDate()}`;

                    if (nowBRT.getHours() === fiveMinutesBeforeOpen.getHours() && 
                        nowBRT.getMinutes() === fiveMinutesBeforeOpen.getMinutes() && 
                        nowBRT.getDate() === fiveMinutesBeforeOpen.getDate() && 
                        !triggeredAlerts.has(triggerKey)) {
                        showToast(`Abertura de ${market.name} em 5 minutos!`, 'üîî');
                        playSound();
                        triggeredAlerts.add(triggerKey);
                        setTimeout(() => triggeredAlerts.delete(triggerKey), 61000);
                    }
                });
            }

            let toastTimeout;
            function showToast(message, icon = 'üîî', duration = 3000) {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toast-message');
                const toastIcon = document.getElementById('toast-icon');
                if(!toast || !toastMessage || !toastIcon) return;

                clearTimeout(toastTimeout);
                toastMessage.textContent = message;
                toastIcon.textContent = icon;
                toast.classList.remove('translate-x-[150%]');
                toast.classList.add('translate-x-0');

                toastTimeout = setTimeout(() => {
                    toast.classList.remove('translate-x-0');
                    toast.classList.add('translate-x-[150%]');
                }, duration);
            }

            function playSound() {
                if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.type = 'sine';
                oscillator.frequency.value = 440;
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.5, audioContext.currentTime + 0.1);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.5);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            }

            function saveAlertSettings() {
                localStorage.setItem('kairosAlertSettings', JSON.stringify(alertSettings));
            }
            function loadAlertSettings() {
                const savedSettings = localStorage.getItem('kairosAlertSettings');
                if (savedSettings) alertSettings = JSON.parse(savedSettings);
            }

            function init() {
                loadAlertSettings();
                populateTimezoneSelect();
                
                const timeInput = document.getElementById('time-input');
                if(timeInput && !timeInput.value) {
                    timeInput.value = formatTime(new Date());
                }
                convertTime();
                fetchCurrencyRates();
                renderAlertSettings();
                renderEconomicEvents();
                
                renderClocks();
                renderSessions();
                renderSessionsChart();

                let lastAlertCheckDay = -1;
                setInterval(() => {
                    renderClocks();
                    renderSessions();
                    checkSessionAlerts();

                    const currentDay = new Date().getDate();
                    if (currentDay !== lastAlertCheckDay) {
                        triggeredAlerts.clear();
                        lastAlertCheckDay = currentDay;
                    }
                }, 1000);
                
                setInterval(renderSessionsChart, 10000);
                setInterval(fetchCurrencyRates, 60000);
                
                document.getElementById('time-input')?.addEventListener('change', convertTime);
                document.getElementById('timezone-select')?.addEventListener('change', convertTime);
            }

            init();
        });
    </script>
</body>
</html>
'''
Improving Code Compatibility for iPhone 12 Pro - Manus
